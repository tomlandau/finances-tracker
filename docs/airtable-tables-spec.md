# מפרט טבלאות Airtable - מערכת ניהול כספים אוטומטית

מסמך זה מכיל מפרט מלא של 4 טבלאות חדשות ליצירה ב-Airtable באמצעות AI.

---

## טבלה 1: Transactions (תנועות)

**תיאור:** טבלה זו שומרת את כל התנועות שנסקרפו מהבנק וכרטיסי האשראי. כל תנועה מקבלת hash ייחודי למניעת כפילויות וסטטוס סיווג.

### שדות:

#### 1. transaction_id (מזהה תנועה)
- **סוג שדה:** Formula (נוסחה)
- **נוסחה:** `CONCATENATE({date}, "-", {amount}, "-", LEFT({description}, 20), "-", {source})`
- **תיאור:** מזהה ייחודי לתנועה הנוצר מתאריך, סכום, תיאור ומקור
- **הערה:** ניתן גם להשתמש ב-Single line text ולמלא אותו מהקוד עם MD5 hash

#### 2. date (תאריך)
- **סוג שדה:** Date
- **פורמט:** DD/MM/YYYY
- **נדרש:** כן
- **תיאור:** תאריך ביצוע התנועה

#### 3. amount (סכום)
- **סוג שדה:** Currency
- **סימן מטבע:** ₪ (שקל)
- **דיוק:** 2 ספרות אחרי הנקודה
- **נדרש:** כן
- **תיאור:** סכום התנועה (שלילי = הוצאה, חיובי = הכנסה)
- **הערה חשובה:** ערכים שליליים מייצגים הוצאות!

#### 4. description (תיאור)
- **סוג שדה:** Single line text
- **נדרש:** כן
- **תיאור:** תיאור התנועה כפי שהתקבל מהבנק/כרטיס אשראי
- **דוגמאות:** "שופרסל עוקשי 123", "דור אלון תחנה", "העברה בנקאית מ..."

#### 5. source (מקור)
- **סוג שדה:** Single select
- **ערכים אפשריים:**
  - Discount - Tom
  - Discount - Yael
  - Isracard *1234 - Tom
  - Isracard *5678 - Tom
  - Isracard *9012 - Yael
  - Isracard *3456 - Yael
  - Max *7890 - Tom
  - Max *2345 - Yael
- **נדרש:** כן
- **תיאור:** שם החשבון או כרטיס האשראי שממנו הגיעה התנועה
- **הערה:** יש להוסיף כרטיסים נוספים לפי הצורך

#### 6. status (סטטוס)
- **סוג שדה:** Single select
- **ערכים אפשריים:**
  - pending (ממתין לסיווג)
  - auto_classified (סווג אוטומטית)
  - manually_classified (סווג ידנית)
  - ignored (התעלם)
- **ברירת מחדל:** pending
- **נדרש:** כן
- **תיאור:** מצב הסיווג של התנועה

#### 7. classified_by_rule (סווג על ידי חוק)
- **סוג שדה:** Link to another record
- **טבלה מקושרת:** Classification Rules (חוקי סיווג)
- **מספר קישורים:** Single record
- **תיאור:** קישור לחוק שסיווג את התנועה (אופציונלי)

#### 8. linked_record (רשומה מקושרת)
- **סוג שדה:** Link to another record
- **טבלאות מקושרות:** הכנסות OR הוצאות (תלוי בסוג התנועה)
- **מספר קישורים:** Single record
- **תיאור:** קישור לרשומת ההכנסה/הוצאה שנוצרה מהתנועה (אופציונלי)
- **הערה:** לאחר סיווג מוצלח, נוצרת רשומה בטבלת הכנסות או הוצאות ומתקשרת לכאן

#### 9. user_id (מזהה משתמש)
- **סוג שדה:** Single select
- **ערכים אפשריים:**
  - usr_tom_001
  - usr_yael_001
- **נדרש:** כן
- **תיאור:** מזהה המשתמש שבבעלותו החשבון/כרטיס

#### 10. created_at (תאריך יצירה)
- **סוג שדה:** Created time
- **פורמט:** DD/MM/YYYY HH:mm
- **תיאור:** תאריך ושעת יצירת הרשומה (אוטומטי)

---

## טבלה 2: Accounts (חשבונות)

**תיאור:** טבלה זו שומרת את רשימת כל חשבונות הבנק וכרטיסי האשראי, יחד עם היתרה האחרונה ותאריך הסקרייפינג האחרון.

### שדות:

#### 1. name (שם)
- **סוג שדה:** Single line text
- **נדרש:** כן
- **תיאור:** שם החשבון או כרטיס האשראי
- **דוגמאות:** "Discount - Tom", "Isracard *1234 - Yael", "Max *7890 - Tom"
- **הערה:** חייב להיות זהה לערכים ב-source בטבלת Transactions

#### 2. type (סוג)
- **סוג שדה:** Single select
- **ערכים אפשריים:**
  - bank (חשבון בנק)
  - credit_card (כרטיס אשראי)
- **נדרש:** כן
- **תיאור:** סוג החשבון

#### 3. last_balance (יתרה אחרונה)
- **סוג שדה:** Currency
- **סימן מטבע:** ₪ (שקל)
- **דיוק:** 2 ספרות אחרי הנקודה
- **תיאור:** היתרה האחרונה שנסקרפה מהחשבון
- **הערה:** רלוונטי בעיקר לחשבון בנק, פחות לכרטיסי אשראי

#### 4. last_scraped (סקרייפינג אחרון)
- **סוג שדה:** Date
- **פורמט:** DD/MM/YYYY
- **תיאור:** תאריך הסקרייפינג המוצלח האחרון
- **שימוש:** הסקרייפר משתמש בתאריך הזה כדי לדעת מאיזה תאריך להתחיל לסקרף

#### 5. credentials_key (מפתח credentials)
- **סוג שדה:** Single line text
- **תיאור:** שם משתנה הסביבה (env var) המכיל את ה-credentials המוצפנים
- **דוגמאות:** "CREDENTIALS_DISCOUNT_TOM", "CREDENTIALS_ISRACARD_YAEL"
- **אבטחה:** השדה מכיל רק את **השם** של המשתנה, לא את הסיסמה עצמה!

#### 6. user_id (מזהה משתמש)
- **סוג שדה:** Single select
- **ערכים אפשריים:**
  - usr_tom_001
  - usr_yael_001
- **נדרש:** כן
- **תיאור:** מזהה המשתמש שבבעלותו החשבון

#### 7. active (פעיל)
- **סוג שדה:** Checkbox
- **ברירת מחדל:** מסומן (true)
- **תיאור:** האם החשבון פעיל (יסוקרף)
- **שימוש:** ניתן לכבות סקרייפינג לחשבון מסוים בלי למחוק אותו

---

## טבלה 3: Classification Rules (חוקי סיווג)

**תיאור:** טבלה זו שומרת חוקים לסיווג אוטומטי של תנועות. כל חוק מכיל תבנית (pattern) שאם התיאור של תנועה מכיל אותה, התנועה מסווגת אוטומטית.

### שדות:

#### 1. match_pattern (תבנית התאמה)
- **סוג שדה:** Single line text
- **נדרש:** כן
- **תיאור:** מחרוזת חיפוש - אם תיאור התנועה מכיל את המחרוזת הזו, החוק תקף
- **דוגמאות:** "שופרסל", "רמי לוי", "דור אלון", "סלקום", "מעבר לפרטי"
- **הערה:** לא case-sensitive, חיפוש חלקי (contains)

#### 2. category (קטגוריה)
- **סוג שדה:** Link to another record
- **טבלאות מקושרות:** מקורות הכנסה OR מקורות הוצאה (תלוי ב-type)
- **מספר קישורים:** Single record
- **נדרש:** כן
- **תיאור:** הקטגוריה שאליה תסווג התנועה

#### 3. entity (ישות)
- **סוג שדה:** Single select
- **ערכים אפשריים:**
  - בית
  - עסק א׳
  - עסק ב׳
- **נדרש:** כן
- **תיאור:** לאיזו ישות שייכת ההוצאה/הכנסה

#### 4. type (סוג)
- **סוג שדה:** Single select
- **ערכים אפשריים:**
  - expense (הוצאה)
  - income (הכנסה)
- **נדרש:** כן
- **תיאור:** האם החוק מיועד להוצאות או הכנסות

#### 5. confidence (רמת ביטחון)
- **סוג שדה:** Single select
- **ערכים אפשריים:**
  - auto (אוטומטי - חוק חדש)
  - confirmed (מאושר - חוק שאומת)
- **ברירת מחדל:** auto
- **נדרש:** כן
- **תיאור:** רמת הביטחון בחוק
- **לוגיקה:** חוק נוצר עם auto ← אחרי 5 שימושים מוצלחים ← משודרג ל-confirmed

#### 6. times_used (מספר שימושים)
- **סוג שדה:** Number
- **ברירת מחדל:** 0
- **דיוק:** Integer (מספר שלם)
- **תיאור:** כמה פעמים החוק שימש לסיווג תנועות
- **שימוש:** עוזר לזהות חוקים פופולריים ולשדרג את ה-confidence

#### 7. created_by (נוצר על ידי)
- **סוג שדה:** Single select
- **ערכים אפשריים:**
  - usr_tom_001
  - usr_yael_001
  - system (מערכת)
- **תיאור:** מי יצר את החוק
- **הערה:** system = נוצר אוטומטית, usr_* = נוצר ידנית דרך Telegram

#### 8. created_at (תאריך יצירה)
- **סוג שדה:** Created time
- **פורמט:** DD/MM/YYYY HH:mm
- **תיאור:** תאריך ושעת יצירת החוק (אוטומטי)

#### 9. description (תיאור)
- **סוג שדה:** Long text
- **תיאור:** הערות חופשיות על החוק (אופציונלי)

---

## טבלה 4: Standing Orders (הוראות קבע)

**תיאור:** טבלה זו שומרת את כל ההוראות הקבע והתשלומים החודשיים הקבועים (משכנתא, גן, פנסיה וכו׳) לצורך חישוב תחזית התזרים.

### שדות:

#### 1. name (שם)
- **סוג שדה:** Single line text
- **נדרש:** כן
- **תיאור:** שם ההוראת הקבע
- **דוגמאות:** "משכנתא", "גן פרטי", "פנסיה", "קופת גמל", "קרן השתלמות", "ביטוח רכב"

#### 2. amount (סכום)
- **סוג שדה:** Currency
- **סימן מטבע:** ₪ (שקל)
- **דיוק:** 2 ספרות אחרי הנקודה
- **נדרש:** כן
- **תיאור:** הסכום החודשי הקבוע

#### 3. day_of_month (יום בחודש)
- **סוג שדה:** Number
- **טווח:** 1-31
- **ברירת מחדל:** 10
- **נדרש:** כן
- **תיאור:** היום בחודש בו החיוב יורד
- **הערה:** רוב החיובים יורדים ב-10 לחודש

#### 4. entity (ישות)
- **סוג שדה:** Single select
- **ערכים אפשריים:**
  - בית
  - עסק א׳
  - עסק ב׳
- **נדרש:** כן
- **תיאור:** לאיזו ישות שייכת ההוצאה

#### 5. category (קטגוריה)
- **סוג שדה:** Link to another record
- **טבלה מקושרת:** מקורות הוצאה
- **מספר קישורים:** Single record
- **תיאור:** הקטגוריה של ההוצאה (מגורים, חינוך, חיסכון וכו׳)

#### 6. active (פעיל)
- **סוג שדה:** Checkbox
- **ברירת מחדל:** מסומן (true)
- **נדרש:** כן
- **תיאור:** האם ההוראת קבע פעילה
- **שימוש:** ניתן לכבות הוראת קבע (למשל אם בוטלה) בלי למחוק אותה

#### 7. notes (הערות)
- **סוג שדה:** Long text
- **תיאור:** הערות חופשיות (אופציונלי)
- **דוגמאות:** "הוראת קבע למשכנתא בבנק דיסקונט", "משתנה כל חצי שנה"

#### 8. created_at (תאריך יצירה)
- **סוג שדה:** Created time
- **פורמט:** DD/MM/YYYY HH:mm
- **תיאור:** תאריך ושעת יצירת הרשומה (אוטומטי)

---

## הערות חשובות ליצירת הטבלאות

### קישורים בין טבלאות (Links)

1. **Transactions → Classification Rules** (חד-כיווני)
   - מ-Transactions: שדה classified_by_rule קושר ל-Classification Rules
   - זה יוצר אוטומטית שדה הפוך ב-Classification Rules שמציג כמה תנועות סווגו לפי חוק זה

2. **Transactions → הכנסות/הוצאות** (חד-כיווני)
   - מ-Transactions: שדה linked_record קושר להכנסות או הוצאות
   - אין צורך ביצירת שדה הפוך

3. **Classification Rules → מקורות הכנסה/מקורות הוצאה** (חד-כיווני)
   - מ-Classification Rules: שדה category קושר לקטגוריות
   - זה יוצר אוטומטית שדה הפוך בטבלת הקטגוריות

4. **Standing Orders → מקורות הוצאה** (חד-כיווני)
   - מ-Standing Orders: שדה category קושר למקורות הוצאה

### Views מומלצים לכל טבלה

#### Transactions
- **View 1: Pending** - סינון: status = "pending", מיון: תאריך (חדש לישן)
- **View 2: Tom's Transactions** - סינון: user_id = "usr_tom_001"
- **View 3: Yael's Transactions** - סינון: user_id = "usr_yael_001"
- **View 4: This Month** - סינון: date בחודש הנוכחי

#### Classification Rules
- **View 1: Active Rules** - מיון: times_used (גבוה לנמוך)
- **View 2: Income Rules** - סינון: type = "income"
- **View 3: Expense Rules** - סינון: type = "expense"
- **View 4: Confirmed Only** - סינון: confidence = "confirmed"

#### Standing Orders
- **View 1: Active** - סינון: active = true, מיון: day_of_month
- **View 2: By Entity** - קיבוץ לפי: entity
- **View 3: Total Monthly** - Sum של amount (רק active)

---

## נוסחאות שימושיות (Formulas)

### Transactions Table

**חישוב חודש/שנה:**
```
DATETIME_FORMAT({date}, 'MM/YYYY')
```

**זיהוי הוצאה/הכנסה:**
```
IF({amount} < 0, "הוצאה", "הכנסה")
```

### Standing Orders Table

**סכום שנתי:**
```
{amount} * 12
```

---

## איך להזין את הטבלאות ב-Airtable AI

1. העתק את המפרט של כל טבלה (כולל כל השדות)
2. פתח את ה-base שלך ב-Airtable
3. לחץ על "+" ליצירת טבלה חדשה
4. בחר "Import data" או השתמש ב-AI של Airtable
5. הדבק את המפרט והבהר ש:
   - שמות השדות בעברית
   - Single select values בעברית
   - ערכי ברירת מחדל כמפורט

---

זה המפרט המלא! כל טבלה מוכנה ליצירה ב-Airtable.
